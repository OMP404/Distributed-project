{% extends 'base.html' %} {% block content %}
<div class="room-container">
    <h2>Game room: {{code}}</h2>
    <img class = "card_front" src="static/images/spades1.png"/>
    <h2 id="current_card">Pick a card to start the game</h2>
    <button class="new_card_button" onClick="pickCard()">Pick a new card</button>
    <h3>History:</h3>
    <div class="history" id="history"></div>
</div>

<script type="text/javascript">
  var socketio = io();

  const history = document.getElementById("history");
  const deck = []

  //function for creating a new message and displaying it in "history" div
  const createMessage = (name, msg) => {
    const content = `
    <div class="text">
        <span>
            <strong>${name}</strong>: ${msg}
        </span>
        <span class="muted">
            ${new Date().toLocaleString()}
        </span>
    </div>
    `;
    history.innerHTML += content;
  };

  //function for adding new card to deck
  const createCard = (name, challenge) => {
    console.log("Adding new card", name)
    deck.push({
        "name": name,
        "challenge": challenge
    })
  }

  //function for picking new card from deck
  const pickCard = () => {
    new_card = deck.pop()
    //change current_card to this one and send information about this action
    document.getElementById("current_card").innerHTML = `${new_card.name}: ${new_card.challenge}`;
    sendActionInfo(`${new_card.name}: ${new_card.challenge}`)
  }

  //function for sending information about aciton as message
  const sendActionInfo = (input) => {
    if (input == "") return;
    socketio.emit("message", { data: input });
  };

  //this event happens when new message is emitted
  socketio.on("message", (data) => {
    createMessage(data.name, data.message);
  });

</script>

{% for card in deck %}
<script type="text/javascript">
  createCard("{{card.name}}", "{{card.challenge}}");
</script>
{% endfor %}

{% for msg in messages %}
<script type="text/javascript">
  createMessage("{{msg.name}}", "{{msg.message}}");
</script>
{% endfor %}
{% endblock %}
